{"version":3,"file":"panaudia-sdk.js","sources":["../lib/attributes.js","../lib/threejs-math/Quaternion.js","../lib/threejs-math/Vector3.js","../lib/threejs-math/Matrix4.js","../lib/threejs-math/Euler.js","../lib/state.js","../lib/connection.js","../lib/panaudia-sdk.ts"],"sourcesContent":["export class PanaudiaNodeAttributes {\n    constructor(uuid, name, ticket, connection) {\n        this.uuid = uuid;\n        this.name = name;\n        this.ticket = ticket;\n        this.connection = connection;\n    }\n\n    static fromJson(jsonData) {\n        let info = JSON.parse(jsonData);\n        if (!info) {\n            return null;\n        }\n        return new PanaudiaNodeAttributes(\n            info['uuid'],\n            info['name'],\n            info['ticket'],\n            info['connection'],\n        );\n    }\n}\n","class Quaternion {\n    constructor(x = 0, y = 0, z = 0, w = 1) {\n        this.isQuaternion = true;\n\n        this._x = x;\n        this._y = y;\n        this._z = z;\n        this._w = w;\n    }\n\n    get x() {\n        return this._x;\n    }\n\n    set x(value) {\n        this._x = value;\n    }\n\n    get y() {\n        return this._y;\n    }\n\n    set y(value) {\n        this._y = value;\n    }\n\n    get z() {\n        return this._z;\n    }\n\n    set z(value) {\n        this._z = value;\n    }\n\n    get w() {\n        return this._w;\n    }\n\n    set w(value) {\n        this._w = value;\n    }\n\n    set(x, y, z, w) {\n        this._x = x;\n        this._y = y;\n        this._z = z;\n        this._w = w;\n        return this;\n    }\n\n    clone() {\n        return new this.constructor(this._x, this._y, this._z, this._w);\n    }\n\n    copy(quaternion) {\n        this._x = quaternion.x;\n        this._y = quaternion.y;\n        this._z = quaternion.z;\n        this._w = quaternion.w;\n\n        return this;\n    }\n\n    setFromEuler(euler, update = true) {\n        const x = euler._x,\n            y = euler._y,\n            z = euler._z,\n            order = euler._order;\n\n        // http://www.mathworks.com/matlabcentral/fileexchange/\n        // \t20696-function-to-convert-between-dcm-euler-angles-quaternions-and-euler-vectors/\n        //\tcontent/SpinCalc.m\n\n        const cos = Math.cos;\n        const sin = Math.sin;\n\n        const c1 = cos(x / 2);\n        const c2 = cos(y / 2);\n        const c3 = cos(z / 2);\n\n        const s1 = sin(x / 2);\n        const s2 = sin(y / 2);\n        const s3 = sin(z / 2);\n\n        switch (order) {\n            case 'XYZ':\n                this._x = s1 * c2 * c3 + c1 * s2 * s3;\n                this._y = c1 * s2 * c3 - s1 * c2 * s3;\n                this._z = c1 * c2 * s3 + s1 * s2 * c3;\n                this._w = c1 * c2 * c3 - s1 * s2 * s3;\n                break;\n\n            case 'YXZ':\n                this._x = s1 * c2 * c3 + c1 * s2 * s3;\n                this._y = c1 * s2 * c3 - s1 * c2 * s3;\n                this._z = c1 * c2 * s3 - s1 * s2 * c3;\n                this._w = c1 * c2 * c3 + s1 * s2 * s3;\n                break;\n\n            case 'ZXY':\n                this._x = s1 * c2 * c3 - c1 * s2 * s3;\n                this._y = c1 * s2 * c3 + s1 * c2 * s3;\n                this._z = c1 * c2 * s3 + s1 * s2 * c3;\n                this._w = c1 * c2 * c3 - s1 * s2 * s3;\n                break;\n\n            case 'ZYX':\n                this._x = s1 * c2 * c3 - c1 * s2 * s3;\n                this._y = c1 * s2 * c3 + s1 * c2 * s3;\n                this._z = c1 * c2 * s3 - s1 * s2 * c3;\n                this._w = c1 * c2 * c3 + s1 * s2 * s3;\n                break;\n\n            case 'YZX':\n                this._x = s1 * c2 * c3 + c1 * s2 * s3;\n                this._y = c1 * s2 * c3 + s1 * c2 * s3;\n                this._z = c1 * c2 * s3 - s1 * s2 * c3;\n                this._w = c1 * c2 * c3 - s1 * s2 * s3;\n                break;\n\n            case 'XZY':\n                this._x = s1 * c2 * c3 - c1 * s2 * s3;\n                this._y = c1 * s2 * c3 - s1 * c2 * s3;\n                this._z = c1 * c2 * s3 + s1 * s2 * c3;\n                this._w = c1 * c2 * c3 + s1 * s2 * s3;\n                break;\n\n            default:\n                console.warn(\n                    'THREE.Quaternion: .setFromEuler() encountered an unknown order: ' +\n                        order,\n                );\n        }\n\n        return this;\n    }\n}\n\nexport { Quaternion };\n","import { Quaternion } from './Quaternion.js';\n\nclass Vector3 {\n    constructor(x = 0, y = 0, z = 0) {\n        Vector3.prototype.isVector3 = true;\n\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n}\n\nconst _vector = /*@__PURE__*/ new Vector3();\nconst _quaternion = /*@__PURE__*/ new Quaternion();\n\nexport { Vector3 };\n","import { Vector3 } from './Vector3.js';\n\nclass Matrix4 {\n    constructor(\n        n11,\n        n12,\n        n13,\n        n14,\n        n21,\n        n22,\n        n23,\n        n24,\n        n31,\n        n32,\n        n33,\n        n34,\n        n41,\n        n42,\n        n43,\n        n44,\n    ) {\n        Matrix4.prototype.isMatrix4 = true;\n\n        this.elements = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n\n        if (n11 !== undefined) {\n            this.set(\n                n11,\n                n12,\n                n13,\n                n14,\n                n21,\n                n22,\n                n23,\n                n24,\n                n31,\n                n32,\n                n33,\n                n34,\n                n41,\n                n42,\n                n43,\n                n44,\n            );\n        }\n    }\n\n    makeRotationFromQuaternion(q) {\n        return this.compose(_zero, q, _one);\n    }\n\n    compose(position, quaternion, scale) {\n        const te = this.elements;\n\n        const x = quaternion._x,\n            y = quaternion._y,\n            z = quaternion._z,\n            w = quaternion._w;\n        const x2 = x + x,\n            y2 = y + y,\n            z2 = z + z;\n        const xx = x * x2,\n            xy = x * y2,\n            xz = x * z2;\n        const yy = y * y2,\n            yz = y * z2,\n            zz = z * z2;\n        const wx = w * x2,\n            wy = w * y2,\n            wz = w * z2;\n\n        const sx = scale.x,\n            sy = scale.y,\n            sz = scale.z;\n\n        te[0] = (1 - (yy + zz)) * sx;\n        te[1] = (xy + wz) * sx;\n        te[2] = (xz - wy) * sx;\n        te[3] = 0;\n\n        te[4] = (xy - wz) * sy;\n        te[5] = (1 - (xx + zz)) * sy;\n        te[6] = (yz + wx) * sy;\n        te[7] = 0;\n\n        te[8] = (xz + wy) * sz;\n        te[9] = (yz - wx) * sz;\n        te[10] = (1 - (xx + yy)) * sz;\n        te[11] = 0;\n\n        te[12] = position.x;\n        te[13] = position.y;\n        te[14] = position.z;\n        te[15] = 1;\n\n        return this;\n    }\n}\n\nconst _v1 = /*@__PURE__*/ new Vector3();\nconst _m1 = /*@__PURE__*/ new Matrix4();\nconst _zero = /*@__PURE__*/ new Vector3(0, 0, 0);\nconst _one = /*@__PURE__*/ new Vector3(1, 1, 1);\nconst _x = /*@__PURE__*/ new Vector3();\nconst _y = /*@__PURE__*/ new Vector3();\nconst _z = /*@__PURE__*/ new Vector3();\n\nexport { Matrix4 };\n","import { Quaternion } from './Quaternion.js';\nimport { Matrix4 } from './Matrix4.js';\n\nconst _matrix = /*@__PURE__*/ new Matrix4();\nconst _quaternion = /*@__PURE__*/ new Quaternion();\n\nfunction clamp(value, min, max) {\n    return Math.max(min, Math.min(max, value));\n}\n\nclass Euler {\n    constructor(x = 0, y = 0, z = 0, order = Euler.DEFAULT_ORDER) {\n        this.isEuler = true;\n        this._x = x;\n        this._y = y;\n        this._z = z;\n        this._order = order;\n    }\n\n    get x() {\n        return this._x;\n    }\n\n    set x(value) {\n        this._x = value;\n    }\n\n    get y() {\n        return this._y;\n    }\n\n    set y(value) {\n        this._y = value;\n    }\n\n    get z() {\n        return this._z;\n    }\n\n    set z(value) {\n        this._z = value;\n    }\n\n    get order() {\n        return this._order;\n    }\n\n    set order(value) {\n        this._order = value;\n    }\n\n    set(x, y, z, order = this._order) {\n        this._x = x;\n        this._y = y;\n        this._z = z;\n        this._order = order;\n        return this;\n    }\n\n    clone() {\n        return new this.constructor(this._x, this._y, this._z, this._order);\n    }\n\n    copy(euler) {\n        this._x = euler._x;\n        this._y = euler._y;\n        this._z = euler._z;\n        this._order = euler._order;\n        return this;\n    }\n\n    setFromRotationMatrix(m, order = this._order, update = true) {\n        // assumes the upper 3x3 of m is a pure rotation matrix (i.e, unscaled)\n\n        const te = m.elements;\n        const m11 = te[0],\n            m12 = te[4],\n            m13 = te[8];\n        const m21 = te[1],\n            m22 = te[5],\n            m23 = te[9];\n        const m31 = te[2],\n            m32 = te[6],\n            m33 = te[10];\n\n        switch (order) {\n            case 'XYZ':\n                this._y = Math.asin(clamp(m13, -1, 1));\n\n                if (Math.abs(m13) < 0.9999999) {\n                    this._x = Math.atan2(-m23, m33);\n                    this._z = Math.atan2(-m12, m11);\n                } else {\n                    this._x = Math.atan2(m32, m22);\n                    this._z = 0;\n                }\n\n                break;\n\n            case 'YXZ':\n                this._x = Math.asin(-clamp(m23, -1, 1));\n\n                if (Math.abs(m23) < 0.9999999) {\n                    this._y = Math.atan2(m13, m33);\n                    this._z = Math.atan2(m21, m22);\n                } else {\n                    this._y = Math.atan2(-m31, m11);\n                    this._z = 0;\n                }\n\n                break;\n\n            case 'ZXY':\n                this._x = Math.asin(clamp(m32, -1, 1));\n\n                if (Math.abs(m32) < 0.9999999) {\n                    this._y = Math.atan2(-m31, m33);\n                    this._z = Math.atan2(-m12, m22);\n                } else {\n                    this._y = 0;\n                    this._z = Math.atan2(m21, m11);\n                }\n\n                break;\n\n            case 'ZYX':\n                this._y = Math.asin(-clamp(m31, -1, 1));\n\n                if (Math.abs(m31) < 0.9999999) {\n                    this._x = Math.atan2(m32, m33);\n                    this._z = Math.atan2(m21, m11);\n                } else {\n                    this._x = 0;\n                    this._z = Math.atan2(-m12, m22);\n                }\n\n                break;\n\n            case 'YZX':\n                this._z = Math.asin(clamp(m21, -1, 1));\n\n                if (Math.abs(m21) < 0.9999999) {\n                    this._x = Math.atan2(-m23, m22);\n                    this._y = Math.atan2(-m31, m11);\n                } else {\n                    this._x = 0;\n                    this._y = Math.atan2(m13, m33);\n                }\n\n                break;\n\n            case 'XZY':\n                this._z = Math.asin(-clamp(m12, -1, 1));\n\n                if (Math.abs(m12) < 0.9999999) {\n                    this._x = Math.atan2(m32, m22);\n                    this._y = Math.atan2(m13, m11);\n                } else {\n                    this._x = Math.atan2(-m23, m33);\n                    this._y = 0;\n                }\n\n                break;\n\n            default:\n                console.warn(\n                    'THREE.Euler: .setFromRotationMatrix() encountered an unknown order: ' +\n                        order,\n                );\n        }\n\n        this._order = order;\n\n        return this;\n    }\n\n    setFromQuaternion(q, order, update) {\n        _matrix.makeRotationFromQuaternion(q);\n\n        return this.setFromRotationMatrix(_matrix, order, update);\n    }\n\n    setFromVector3(v, order = this._order) {\n        return this.set(v.x, v.y, v.z, order);\n    }\n\n    reorder(newOrder) {\n        // WARNING: this discards revolution information -bhouston\n\n        _quaternion.setFromEuler(this);\n\n        return this.setFromQuaternion(_quaternion, newOrder);\n    }\n\n    equals(euler) {\n        return (\n            euler._x === this._x &&\n            euler._y === this._y &&\n            euler._z === this._z &&\n            euler._order === this._order\n        );\n    }\n\n    fromArray(array) {\n        this._x = array[0];\n        this._y = array[1];\n        this._z = array[2];\n        if (array[3] !== undefined) this._order = array[3];\n\n        this._onChangeCallback();\n\n        return this;\n    }\n\n    toArray(array = [], offset = 0) {\n        array[offset] = this._x;\n        array[offset + 1] = this._y;\n        array[offset + 2] = this._z;\n        array[offset + 3] = this._order;\n\n        return array;\n    }\n\n    *[Symbol.iterator]() {\n        yield this._x;\n        yield this._y;\n        yield this._z;\n        yield this._order;\n    }\n}\n\nEuler.DEFAULT_ORDER = 'XYZ';\n\nexport { Euler };\n","import { Euler } from './threejs-math/Euler';\n\nexport class PanaudiaNodeState {\n    constructor(\n        x = 0,\n        y = 0,\n        z = 0,\n        yaw = 0,\n        pitch = 0,\n        roll = 0,\n        volume = 0,\n        gone = 0,\n        uuid = '',\n    ) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.yaw = yaw;\n        this.pitch = pitch;\n        this.roll = roll;\n        this.volume = volume;\n        this.gone = gone !== 0;\n        this.uuid = uuid;\n    }\n\n\n    static fromWebGLCoordinates2(px, py, pz, rx, ry, rz) {\n        let rotation = new Euler(rx, ry, rz);\n        rotation.reorder('YXZ');\n\n        let x = px / 2 + 0.5;\n        let y = -(pz / 2) + 0.5;\n        let z = py / 2 + 0.5;\n\n        return new PanaudiaNodeState(\n            x,\n            y,\n            z,\n            radiansToDegrees(rotation.y),\n            radiansToDegrees(rotation.x),\n            -radiansToDegrees(rotation.z),\n        );\n    }\n\n    static fromWebGLCoordinates(px, py, pz, rx, ry, rz) {\n        let rotation = new Euler(rx, ry, rz);\n        rotation.reorder('YXZ');\n\n        // let x = px / 2 + 0.5;\n        // let y = -(pz / 2) + 0.5;\n        // let z = py / 2 + 0.5;\n\n        let x = -(pz / 2) + 0.5;\n        let y = -(px / 2) + 0.5;\n        let z = py / 2 + 0.5;\n\n        return new PanaudiaNodeState(\n            x,\n            y,\n            z,\n            radiansToDegrees(rotation.y),\n            radiansToDegrees(rotation.x),\n            radiansToDegrees(rotation.z),\n        );\n    }\n\n\n    static fromDataBuffer(buffer) {\n        const view = new DataView(buffer);\n        const a = (\n            '0000000000000000' + view.getBigUint64(0, false).toString(16)\n        ).slice(-16);\n        const b = (\n            '0000000000000000' + view.getBigUint64(8, false).toString(16)\n        ).slice(-16);\n        const guid = `${a.slice(0, 8)}-${a.slice(8, 12)}-${a.slice(12, 16)}-${b.slice(0, 4)}-${b.slice(4, 16)}`;\n\n        const state = new PanaudiaNodeState(\n            view.getFloat32(16, true),\n            view.getFloat32(20, true),\n            view.getFloat32(24, true),\n            view.getFloat32(28, true),\n            view.getFloat32(32, true),\n            view.getFloat32(36, true),\n            view.getFloat32(40, true),\n            view.getInt32(44, true),\n            guid,\n        );\n\n        return state;\n    }\n\n    static fromBlobAsWeb(buffer, stateCallback) {\n        var arrayBuffer;\n        var fileReader = new FileReader();\n        fileReader.onload = function (event) {\n            arrayBuffer = event.target.result;\n\n            const view = new DataView(arrayBuffer);\n            const a = (\n                '0000000000000000' + view.getBigUint64(0, false).toString(16)\n            ).slice(-16);\n            const b = (\n                '0000000000000000' + view.getBigUint64(8, false).toString(16)\n            ).slice(-16);\n            const guid = `${a.slice(0, 8)}-${a.slice(8, 12)}-${a.slice(12, 16)}-${b.slice(0, 4)}-${b.slice(4, 16)}`;\n\n            const state = new PanaudiaNodeState(\n                view.getFloat32(16, true),\n                view.getFloat32(20, true),\n                view.getFloat32(24, true),\n                view.getFloat32(28, true),\n                view.getFloat32(32, true),\n                view.getFloat32(36, true),\n                view.getFloat32(40, true),\n                view.getInt32(44, true),\n                guid,\n            );\n\n            stateCallback(state.asWebGLCoordinates());\n        };\n        fileReader.readAsArrayBuffer(buffer);\n    }\n\n    toDataBuffer() {\n        const buffer = new ArrayBuffer(48);\n        const view = new DataView(buffer);\n        view.setFloat32(16, this.x, true);\n        view.setFloat32(20, this.y, true);\n        view.setFloat32(24, this.z, true);\n        view.setFloat32(28, this.yaw, true);\n        view.setFloat32(32, this.pitch, true);\n        view.setFloat32(36, this.roll, true);\n        return buffer;\n    }\n\n    asWebGLCoordinates2() {\n        let rotation = new Euler(\n            degreesToRadians(this.pitch),\n            degreesToRadians(this.yaw),\n            -degreesToRadians(this.roll),\n            'YXZ',\n        );\n        rotation.reorder('XYZ');\n        return {\n            uuid: this.uuid,\n            position: {\n                x: (this.x - 0.5) * 2,\n                y: (this.z - 0.5) * 2,\n                z: -((this.y - 0.5) * 2),\n            },\n            rotation: { x: rotation.x, y: rotation.y, z: rotation.z },\n            vol: this.volume,\n            gone: this.gone,\n        };\n    }\n\n    asWebGLCoordinates() {\n        let rotation = new Euler(\n            degreesToRadians(this.pitch),\n            degreesToRadians(this.yaw),\n            degreesToRadians(this.roll),\n            'YXZ',\n        );\n        rotation.reorder('XYZ');\n        return {\n            uuid: this.uuid,\n            position: {\n                x: -((this.y - 0.5) * 2),\n                y: (this.z - 0.5) * 2,\n                z: -((this.x - 0.5) * 2),\n            },\n            rotation: { x: rotation.x, y: rotation.y, z: rotation.z },\n            vol: this.volume,\n            gone: this.gone,\n        };\n    }\n\n}\n\nfunction radiansToDegrees(a) {\n    return (a / Math.PI) * 180;\n}\n\nfunction degreesToRadians(a) {\n    return (a / 180.0) * Math.PI;\n}\n","import { PanaudiaNodeAttributes } from './attributes.js';\nimport { PanaudiaNodeState } from './state.js';\n\nlet ws;\nlet pc;\nlet dcJson;\nlet dcData;\nlet attributesCallback;\nlet stateCallback;\nlet connectionStatusCallback;\n\nfunction setAttributesCallback(cb) {\n    attributesCallback = cb;\n}\n\nfunction setStateCallback(cb) {\n    stateCallback = cb;\n}\n\nfunction setConnectionStatusCallback(cb) {\n    connectionStatusCallback = cb;\n}\n\nfunction move(px, py, pz, rx, ry, rz) {\n    if (dcData !== undefined) {\n        if (dcData.readyState === 'open') {\n            let sourceState = PanaudiaNodeState.fromWebGLCoordinates(\n                px,\n                py,\n                pz,\n                rx,\n                ry,\n                rz,\n            );\n            dcData.send(sourceState.toDataBuffer());\n        }\n    }\n}\n\nfunction move_ambisonic(x, y, z, yaw, pitch, roll) {\n    if (dcData !== undefined) {\n        if (dcData.readyState === 'open') {\n            let sourceState = new PanaudiaNodeState(\n            x,\n            y,\n            z,\n            yaw,\n            pitch,\n            roll\n        );\n            dcData.send(sourceState.toDataBuffer());\n        }\n    }\n}\n\nfunction disconnect() {\n    ws.close();\n}\n\nfunction connect(\n    ticket,\n    domParentId,\n    position,\n    rotation,\n    attrs = {},\n    url = 'https://panaudia.com/entrance',\n) {\n\n    let sourceState = PanaudiaNodeState.fromWebGLCoordinates(\n        position.x,\n        position.y,\n        position.z,\n        rotation.x,\n        rotation.y,\n        rotation.z,\n    );\n\n    let locationAttrs = {\n        \"loc[x]\": sourceState.x,\n        \"loc[y]\": sourceState.y,\n        \"loc[z]\": sourceState.z,\n        \"loc[yaw]\": sourceState.yaw,\n        \"loc[pitch]\": sourceState.pitch,\n        \"loc[roll]\": sourceState.roll,\n    }\n\n    fetch(url + '?ticket=' + ticket)\n        .then((response) => {\n            if (response.ok) {\n                return response.json();\n            }\n        })\n        .then((data) => {\n            if (data.status === 'ok') {\n                const params = new URLSearchParams({\n                    ticket: ticket,\n                    ...attrs,\n                    ...locationAttrs\n                });\n                const connectionUrl = data.url + '?' + params.toString();\n                connectToSpace(connectionUrl, domParentId);\n            } else {\n                console.error('lookup failed');\n            }\n        })\n        .catch((error) => console.error('lookup error:', error));\n}\n\n\n\nfunction connectToSpace(connectionUrl, domPlayerParentId) {\n    connectionStatusCallback('connecting', 'Connecting');\n\n    navigator.mediaDevices\n        .getUserMedia({\n            audio: {\n                autoGainControl: false,\n                channelCount: 2,\n                echoCancellation: false,\n                latency: 0,\n                noiseSuppression: false,\n                sampleRate: 48000,\n                sampleSize: 16,\n                volume: 1.0,\n            },\n        })\n        .then((stream) => {\n            pc = new RTCPeerConnection({\n                iceServers: [\n                    { urls: 'stun:stun.l.google.com:19302' },\n                    { urls: 'stun:stun.l.google.com:5349' },\n                    { urls: 'stun:stun1.l.google.com:3478' },\n                    { urls: 'stun:stun1.l.google.com:5349' },\n                ],\n            });\n\n            stream.getTracks().forEach((track) => pc.addTrack(track, stream));\n\n            addDataChannels(pc);\n\n            // force the offer to include actual stereo\n            pc.createOffer().then((d) => {\n                d.sdp = d.sdp.replace('a=fmtp:111 ', 'a=fmtp:111 stereo=1; ');\n                d.sdp = d.sdp.replace('stereo=1;', 'stereo=1; sprop-stereo=1;');\n\n                pc.setLocalDescription(d).then((r) => {\n                    init_ws(connectionUrl);\n                });\n            });\n\n            pc.ontrack = function (event) {\n                connectionStatusCallback('connected', 'Connected');\n\n                let el = document.createElement(event.track.kind);\n                el.srcObject = event.streams[0];\n                el.autoplay = true;\n                el.controls = true;\n                el.id = 'panaudia-player';\n\n                document.getElementById(domPlayerParentId).prepend(el);\n\n                event.track.onmute = function (event) {\n                    el.play();\n                };\n\n                event.streams[0].onremovetrack = ({ track }) => {\n                    if (el.parentNode) {\n                        el.parentNode.removeChild(el);\n                    }\n                };\n            };\n        })\n        .catch(window.alert);\n}\n\nfunction addDataChannels(pc) {\n    dcJson = pc.createDataChannel('attributes');\n    dcJson.onmessage = (msg) => {\n        let attributes = PanaudiaNodeAttributes.fromJson(msg.data);\n        if (!attributes) {\n            return log('failed to parse attributes');\n        }\n        attributesCallback(attributes);\n    };\n\n    let _dcData = pc.createDataChannel('state');\n    _dcData.onopen = () => {\n        dcData = _dcData;\n        connectionStatusCallback('data_connected', 'Data channel connected');\n    };\n    _dcData.onmessage = (msg) => {\n        if (msg.data instanceof ArrayBuffer) {\n            let state = PanaudiaNodeState.fromDataBuffer(msg.data);\n            stateCallback(state.asWebGLCoordinates());\n        } else {\n            PanaudiaNodeState.fromBlobAsWeb(msg.data, stateCallback);\n        }\n    };\n}\n\nfunction init_ws(url) {\n    ws = new WebSocket(url);\n\n    ws.onclose = function (evt) {\n        connectionStatusCallback('disconnected', 'Disconnected');\n    };\n\n    ws.onmessage = function (evt) {\n        let msg = JSON.parse(evt.data);\n        if (!msg) {\n            return log('failed to parse msg');\n        }\n\n        switch (msg.event) {\n            case 'answer':\n                let answer = JSON.parse(msg.data);\n                if (!answer) {\n                    return log('failed to parse answer');\n                }\n                try {\n                    console.log(answer);\n                    pc.setRemoteDescription(answer);\n                } catch (e) {\n                    alert(e);\n                }\n                return;\n\n            case 'candidate':\n                let candidate = JSON.parse(msg.data);\n                if (!candidate) {\n                    return log('failed to parse candidate');\n                }\n                pc.addIceCandidate(candidate);\n                return;\n\n            case 'error':\n                let errorMsg = JSON.parse(msg.data);\n                if (!errorMsg) {\n                    return log('failed to parse error message');\n                }\n                console.log('errorMsg', errorMsg);\n                connectionStatusCallback('error', errorMsg.message);\n                return;\n        }\n    };\n\n    ws.onerror = function (evt) {\n        log('ERROR: ' + evt);\n    };\n\n    ws.onopen = function (evt) {\n        let data = JSON.stringify(pc.localDescription);\n        ws.send(JSON.stringify({ event: 'offer', data: data }));\n\n        pc.onicecandidate = (e) => {\n            if (e.candidate && e.candidate.candidate !== '') {\n                let data = JSON.stringify(e.candidate);\n                ws.send(JSON.stringify({ event: 'candidate', data: data }));\n            }\n        };\n    };\n}\n\nconst log = (msg) => {\n    console.log(msg);\n};\n\nexport {\n    setAttributesCallback as _setAttributesCallback,\n    setStateCallback as _setStateCallback,\n    setConnectionStatusCallback as _setConnectionStatusCallback,\n    move as _move,\n    move_ambisonic as _move_ambisonic,\n    disconnect as _disconnect,\n    connect as _connect,\n};\n","import {\n    _setAttributesCallback,\n    _setStateCallback,\n    _setConnectionStatusCallback,\n    _move,\n    _disconnect,\n    _connect,\n} from './connection.js'\n\ninterface Vec3 {\n    x: number\n    y: number\n    z: number\n}\n\ninterface NodeAttributes {\n    uuid: string\n    name: string\n    ticket: { string: any }\n    connection: { string: any }\n}\n\ninterface NodeState {\n    uuid: string\n    position: Vec3\n    rotation: Vec3\n    volume: number\n    gone: boolean\n}\n\ninterface StateCallback {\n    (state: NodeState): void\n}\ninterface AttributesCallback {\n    (attrs: NodeAttributes): void\n}\n\ntype ConnectionStatus = \"connecting\" | \"connected\" | \"data_connected\" | \"disconnected\" | \"error\";\n\ninterface ConnectionStatusCallback {\n    (status: ConnectionStatus, message: string): void\n}\n\nexport function setAttributesCallback(cb: AttributesCallback): void {\n    _setAttributesCallback(cb)\n}\n\nexport function setStateCallback(cb: StateCallback): void {\n    _setStateCallback(cb)\n}\n\nexport function setConnectionStatusCallback(cb: ConnectionStatusCallback) {\n    _setConnectionStatusCallback(cb)\n}\n\nexport function move(position: Vec3, rotation: Vec3): void {\n    _move(\n        position.x,\n        position.y,\n        position.z,\n        rotation.x,\n        rotation.y,\n        rotation.z,\n    )\n}\n\nexport function disconnect(): void {\n    _disconnect()\n}\n\nexport function connect(\n    ticket: string,\n    domParentId: string,\n    position: Vec3,\n    rotation: Vec3,\n    attrs: { [key: string]: string } = {},\n    url: string = 'https://panaudia.com/entrance',\n): void {\n    _connect(ticket, domParentId, position, rotation, attrs, url)\n}\n"],"names":["PanaudiaNodeAttributes","uuid","name","ticket","connection","jsonData","info","Quaternion","x","y","z","w","value","quaternion","euler","update","order","cos","sin","c1","c2","c3","s1","s2","s3","Vector3","Matrix4","n11","n12","n13","n14","n21","n22","n23","n24","n31","n32","n33","n34","n41","n42","n43","n44","q","_zero","_one","position","scale","te","x2","y2","z2","xx","xy","xz","yy","yz","zz","wx","wy","wz","sx","sy","sz","_matrix","_quaternion","clamp","min","max","Euler","m","m11","m12","m13","m21","m22","m23","m31","m32","m33","v","newOrder","array","offset","PanaudiaNodeState","yaw","pitch","roll","volume","gone","px","py","pz","rx","ry","rz","rotation","radiansToDegrees","buffer","view","a","b","guid","stateCallback","arrayBuffer","fileReader","event","state","degreesToRadians","ws","pc","dcJson","dcData","attributesCallback","connectionStatusCallback","setAttributesCallback","cb","setStateCallback","setConnectionStatusCallback","move","sourceState","disconnect","connect","domParentId","attrs","url","locationAttrs","response","data","params","connectionUrl","connectToSpace","error","domPlayerParentId","stream","track","addDataChannels","d","r","init_ws","el","msg","attributes","log","_dcData","evt","answer","e","candidate","errorMsg","_setAttributesCallback","_setStateCallback","_setConnectionStatusCallback","_move","_disconnect","_connect"],"mappings":"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"}